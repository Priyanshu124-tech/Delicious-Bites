{% extends 'restaurant/base.html' %}

{% block content %}
<div class="max-w-2xl mx-auto">
    <!-- Header -->
    <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
        <div class="flex items-center mb-4">
            <a href="{% url 'admin_menu' %}" class="text-gray-600 hover:text-gray-800 mr-4">
                <i class="fas fa-arrow-left text-xl"></i>
            </a>
            <h1 class="font-display text-3xl font-bold text-gray-800">Edit Menu Item</h1>
        </div>
        <p class="text-gray-600">Update the details of this delicious dish</p>
    </div>

    <!-- Form -->
    <div class="bg-white rounded-xl shadow-lg p-8">
        <form method="post" enctype="multipart/form-data" class="space-y-6">
            {% csrf_token %}
            
            <div>
                <label for="name" class="block text-sm font-bold text-gray-700 mb-2">
                    <i class="fas fa-utensils mr-2 accent-color"></i>Dish Name
                </label>
                <input type="text" name="name" id="name" value="{{ item.name }}" required 
                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all">
            </div>

            <div>
                <label for="description" class="block text-sm font-bold text-gray-700 mb-2">
                    <i class="fas fa-align-left mr-2 accent-color"></i>Description
                </label>
                <textarea name="description" id="description" rows="4" required
                          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all">{{ item.description }}</textarea>
            </div>

            <div class="grid md:grid-cols-2 gap-6">
                <div>
                    <label for="price" class="block text-sm font-bold text-gray-700 mb-2">
                        <i class="fas fa-rupee-sign mr-2 accent-color"></i>Price (‚Çπ)
                    </label>
                    <div class="relative">
                        <span class="absolute left-3 top-3 text-gray-500">‚Çπ</span>
                        <input type="number" name="price" id="price" step="0.01" min="0" value="{{ item.price }}" required
                               class="w-full pl-8 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all">
                    </div>
                </div>

                <div>
                    <label for="category" class="block text-sm font-bold text-gray-700 mb-2">
                        <i class="fas fa-tags mr-2 accent-color"></i>Category
                    </label>
                    <select name="category" id="category" required
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all">
                        <option value="Indian" {% if item.category == 'Indian' %}selected{% endif %}>üçõ Indian</option>
                        <option value="Chinese" {% if item.category == 'Chinese' %}selected{% endif %}>ü•¢ Chinese</option>
                        <option value="Italian" {% if item.category == 'Italian' %}selected{% endif %}>üçù Italian</option>
                        <option value="Mexican" {% if item.category == 'Mexican' %}selected{% endif %}>üåÆ Mexican</option>
                        <option value="Other" {% if item.category == 'Other' %}selected{% endif %}>üç¥ Other</option>
                    </select>
                </div>
            </div>

            <!-- Photo Upload -->
            <div>
                <label for="photo" class="block text-sm font-bold text-gray-700 mb-2">
                    <i class="fas fa-camera mr-2 accent-color"></i>Dish Photo
                </label>
                {% if item.photo %}
                    <div class="mb-4">
                        <p class="text-sm font-semibold text-gray-700 mb-2">Current photo:</p>
                        <img src="{{ item.photo.url }}" alt="{{ item.name }}" class="w-32 h-32 object-cover rounded-lg border border-gray-300">
                    </div>
                {% endif %}
                <input type="file" name="photo" id="photo" accept="image/*"
                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all"
                       onchange="previewImage(this)">
                <p class="text-sm text-gray-500 mt-2">Upload a new photo to replace the current one (optional)</p>
                
                <!-- Photo Preview -->
                <div id="imagePreview" class="mt-4 hidden">
                    <p class="text-sm font-semibold text-gray-700 mb-2">New photo preview:</p>
                    <div class="relative inline-block">
                        <img id="previewImg" src="" alt="Preview" class="w-32 h-32 object-cover rounded-lg border border-gray-300">
                        <button type="button" onclick="removePreview()" 
                                class="absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs hover:bg-red-600 transition-colors">
                            √ó
                        </button>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="flex space-x-4">
                <button type="submit" 
                        class="flex-1 bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-lg transition-all transform hover:scale-105 shadow-lg">
                    <i class="fas fa-save mr-2"></i>Save Changes
                </button>
                <a href="{% url 'admin_menu' %}" 
                   class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-lg transition-all text-center">
                    <i class="fas fa-times mr-2"></i>Cancel
                </a>
            </div>
        </form>
    </div>
</div>

<script>
function previewImage(input) {
    const file = input.files[0];
    const preview = document.getElementById('imagePreview');
    const previewImg = document.getElementById('previewImg');
    
    if (file) {
        const reader = new FileReader();
        
        reader.onload = function(e) {
            previewImg.src = e.target.result;
            preview.classList.remove('hidden');
        };
        
        reader.readAsDataURL(file);
    } else {
        removePreview();
    }
}

function removePreview() {
    const preview = document.getElementById('imagePreview');
    const previewImg = document.getElementById('previewImg');
    const fileInput = document.getElementById('photo');
    
    preview.classList.add('hidden');
    previewImg.src = '';
    fileInput.value = '';
}
</script>
{% endblock %}
