{% extends 'restaurant/base.html' %}

{% block content %}
<div class="max-w-2xl mx-auto">
    <!-- Header -->
    <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
        <div class="flex items-center mb-4">
            <a href="{% url 'admin_menu' %}" class="text-gray-600 hover:text-gray-800 mr-4">
                <i class="fas fa-arrow-left text-xl"></i>
            </a>
            <h1 class="font-display text-3xl font-bold text-gray-800">Add New Menu Item</h1>
        </div>
        <p class="text-gray-600">Create a delicious new dish for your restaurant menu</p>
    </div>

    <!-- Form -->
    <div class="bg-white rounded-xl shadow-lg p-8">
        <form method="post" enctype="multipart/form-data" class="space-y-6">
            {% csrf_token %}
            
            <div>
                <label for="name" class="block text-sm font-bold text-gray-700 mb-2">
                    <i class="fas fa-utensils mr-2 accent-color"></i>Dish Name
                </label>
                <input type="text" name="name" id="name" required 
                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all"
                       placeholder="e.g., Butter Chicken">
            </div>

            <div>
                <label for="description" class="block text-sm font-bold text-gray-700 mb-2">
                    <i class="fas fa-align-left mr-2 accent-color"></i>Description
                </label>
                <textarea name="description" id="description" rows="4" required
                          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all"
                          placeholder="Describe the ingredients, preparation method, and what makes this dish special..."></textarea>
            </div>

            <div class="grid md:grid-cols-2 gap-6">
                <div>
                    <label for="price" class="block text-sm font-bold text-gray-700 mb-2">
                        <i class="fas fa-rupee-sign mr-2 accent-color"></i>Price (‚Çπ)
                    </label>
                    <div class="relative">
                        <span class="absolute left-3 top-3 text-gray-500">‚Çπ</span>
                        <input type="number" name="price" id="price" step="0.01" min="0" required
                               class="w-full pl-8 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all"
                               placeholder="0.00">
                    </div>
                </div>

                <div>
                    <label for="category" class="block text-sm font-bold text-gray-700 mb-2">
                        <i class="fas fa-tags mr-2 accent-color"></i>Category
                    </label>
                    <select name="category" id="category" required
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all">
                        <option value="">Select a category...</option>
                        <option value="Indian">üçõ Indian</option>
                        <option value="Chinese">ü•¢ Chinese</option>
                        <option value="Italian">üçù Italian</option>
                        <option value="Mexican">üåÆ Mexican</option>
                        <option value="Other">üç¥ Other</option>
                    </select>
                </div>
            </div>

            <!-- Photo Upload -->
            <div>
                <label for="photo" class="block text-sm font-bold text-gray-700 mb-2">
                    <i class="fas fa-camera mr-2 accent-color"></i>Dish Photo
                </label>
                <input type="file" name="photo" id="photo" accept="image/*"
                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all"
                       onchange="previewImage(this)">
                <p class="text-sm text-gray-500 mt-2">Upload a high-quality image of the dish (optional)</p>
                
                <!-- Photo Preview -->
                <div id="imagePreview" class="mt-4 hidden">
                    <p class="text-sm font-semibold text-gray-700 mb-2">Preview:</p>
                    <div class="relative inline-block">
                        <img id="previewImg" src="" alt="Preview" class="w-32 h-32 object-cover rounded-lg border border-gray-300">
                        <button type="button" onclick="removePreview()" 
                                class="absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs hover:bg-red-600 transition-colors">
                            √ó
                        </button>
                    </div>
                </div>
            </div>

            <!-- Enhanced Preview Section -->
            <div class="bg-gray-50 rounded-lg p-6">
                <h3 class="text-lg font-semibold mb-4 flex items-center">
                    <i class="fas fa-eye mr-2 accent-color"></i>Menu Item Preview
                </h3>
                <div class="bg-white rounded-lg overflow-hidden shadow-md max-w-md">
                    <!-- Preview Image -->
                    <div id="previewImageContainer" class="h-48 bg-gray-200 flex items-center justify-center">
                        <img id="previewMenuImg" src="" alt="Preview" class="w-full h-full object-cover hidden">
                        <div id="placeholderIcon" class="text-gray-400">
                            <i class="fas fa-image text-4xl mb-2"></i>
                            <p class="text-sm">No image selected</p>
                        </div>
                    </div>
                    
                    <!-- Preview Content -->
                    <div class="p-4">
                        <h4 class="font-semibold text-gray-800 text-lg mb-2" id="preview-name">Dish Name</h4>
                        <p class="text-gray-600 text-sm mb-3" id="preview-description">Description will appear here...</p>
                        
                        <div class="flex justify-between items-center">
                            <span class="text-xl font-bold accent-color" id="preview-price">‚Çπ0.00</span>
                            <span class="inline-block px-2 py-1 bg-gray-200 text-gray-700 text-xs rounded" id="preview-category">Category</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="flex space-x-4">
                <button type="submit" 
                        class="flex-1 bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-lg transition-all transform hover:scale-105 shadow-lg">
                    <i class="fas fa-plus mr-2"></i>Add Menu Item
                </button>
                <a href="{% url 'admin_menu' %}" 
                   class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-lg transition-all text-center">
                    <i class="fas fa-times mr-2"></i>Cancel
                </a>
            </div>
        </form>
    </div>
</div>

<script>
function previewImage(input) {
    const file = input.files[0];
    const preview = document.getElementById('imagePreview');
    const previewImg = document.getElementById('previewImg');
    const previewMenuImg = document.getElementById('previewMenuImg');
    const placeholderIcon = document.getElementById('placeholderIcon');
    
    if (file) {
        const reader = new FileReader();
        
        reader.onload = function(e) {
            // Small preview
            previewImg.src = e.target.result;
            preview.classList.remove('hidden');
            
            // Menu card preview
            previewMenuImg.src = e.target.result;
            previewMenuImg.classList.remove('hidden');
            placeholderIcon.classList.add('hidden');
        };
        
        reader.readAsDataURL(file);
    } else {
        removePreview();
    }
}

function removePreview() {
    const preview = document.getElementById('imagePreview');
    const previewImg = document.getElementById('previewImg');
    const previewMenuImg = document.getElementById('previewMenuImg');
    const placeholderIcon = document.getElementById('placeholderIcon');
    const fileInput = document.getElementById('photo');
    
    // Hide small preview
    preview.classList.add('hidden');
    previewImg.src = '';
    
    // Reset menu card preview
    previewMenuImg.src = '';
    previewMenuImg.classList.add('hidden');
    placeholderIcon.classList.remove('hidden');
    
    fileInput.value = '';
}

// Live preview functionality for form fields
document.addEventListener('DOMContentLoaded', function() {
    const nameInput = document.getElementById('name');
    const descriptionInput = document.getElementById('description');
    const priceInput = document.getElementById('price');
    const categorySelect = document.getElementById('category');
    
    const previewName = document.getElementById('preview-name');
    const previewDescription = document.getElementById('preview-description');
    const previewPrice = document.getElementById('preview-price');
    const previewCategory = document.getElementById('preview-category');
    
    function updatePreview() {
        previewName.textContent = nameInput.value || 'Dish Name';
        previewDescription.textContent = descriptionInput.value || 'Description will appear here...';
        previewPrice.textContent = '‚Çπ' + (priceInput.value || '0.00');
        
        const selectedOption = categorySelect.options[categorySelect.selectedIndex];
        previewCategory.textContent = selectedOption.text || 'Category';
        
        // Update category styling
        previewCategory.className = 'inline-block px-2 py-1 text-xs rounded ';
        if (categorySelect.value) {
            previewCategory.className += 'bg-blue-100 text-blue-800';
        } else {
            previewCategory.className += 'bg-gray-200 text-gray-700';
        }
    }
    
    nameInput.addEventListener('input', updatePreview);
    descriptionInput.addEventListener('input', updatePreview);
    priceInput.addEventListener('input', updatePreview);
    categorySelect.addEventListener('change', updatePreview);
});
</script>
{% endblock %}
